<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MNS | Market Navigation System</title>
  <style>
    body {
      margin: 0;
      background: #000;
      color: #00ff66;
      font-family: "Courier New", monospace;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    .terminal {
      width: 640px;
      height: 420px;
      border: 1px solid #00ff66;
      padding: 16px;
      box-sizing: border-box;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(0,255,102,0.2);
      position: relative;
    }

    .line {
      white-space: pre;
      line-height: 1.35;
    }

    .dim {
      color: rgba(0,255,102,0.6);
    }
  </style>
</head>
<body>
  <div class="terminal" id="terminal"></div>

  <script>
    /* ================================
       Phase 9.6.1 — Tunnel Visualization Engine
       ================================ */

    /* ---------- Deterministic PRNG ---------- */
    function createPRNG(seed) {
      let s = seed >>> 0;
      return function () {
        s = (s * 1664525 + 1013904223) >>> 0;
        return s / 4294967296;
      };
    }
    const rand = createPRNG(9461);

    /* ---------- Global State ---------- */
    const TunnelState = {
      phase: "9.6",
      status: "STABLE",
      location: "TBILISI_HUB_01",
      depth: 72,
      nodes: [
        { id: "TBILISI_01", load: 0.71, status: "STABLE" }
      ]
    };

    /* ---------- Config ---------- */
    const TICK_MS = 900;
    const MAX_LINES = 120;
    const BAR_WIDTH = 12;

    /* ---------- State Update Logic ---------- */
    function updateState() {
      // Node load drift (smooth, bounded)
      TunnelState.nodes.forEach(node => {
        const drift = (rand() - 0.5) * 0.06;
        node.load = Math.min(1, Math.max(0, node.load + drift));
        node.status = "STABLE";
      });

      // Tunnel depth drift
      const depthDrift = (rand() - 0.5) * 2;
      TunnelState.depth = Math.min(
        100,
        Math.max(0, TunnelState.depth + depthDrift)
      );
    }

    /* ---------- Render Helpers ---------- */
    function depthBar(depth) {
      const filled = Math.round((depth / 100) * BAR_WIDTH);
      const empty = BAR_WIDTH - filled;
      return (
        "[" +
        "█".repeat(filled) +
        "░".repeat(empty) +
        `] ${Math.round(depth)}%`
      );
    }

    function telemetryLine() {
      const node = TunnelState.nodes[0];
      return (
        `> NODE ${node.id} | ` +
        `LOAD ${node.load.toFixed(2)} | ` +
        `STATUS ${node.status}`
      );
    }

    /* ---------- Render Logic ---------- */
    function render(terminal) {
      const fragment = document.createDocumentFragment();

      // Telemetry line
      const line = document.createElement("div");
      line.className = "line";
      line.textContent = telemetryLine();
      fragment.appendChild(line);

      // Depth bar
      const bar = document.createElement("div");
      bar.className = "line dim";
      bar.textContent = `TUNNEL DEPTH ${depthBar(TunnelState.depth)}`;
      fragment.appendChild(bar);

      terminal.appendChild(fragment);

      // Line cap
      while (terminal.children.length > MAX_LINES) {
        terminal.removeChild(terminal.firstChild);
      }

      // Auto-scroll
      terminal.scrollTop = terminal.scrollHeight;
    }

    /* ---------- Boot Sequence ---------- */
    (function init() {
      const terminal = document.getElementById("terminal");

      const header = [
        `> SYSTEM: MNS (Market Navigation System)`,
        `> STATUS: ${TunnelState.status}`,
        `> LOCATION: ${TunnelState.location}`,
        `> CONNECTION: SECURE_ENCRYPTED`,
        `> ACCESS: RESTRICTED_TO_PILOTS`,
        `> SYNC PHASE: ${TunnelState.phase}`,
        `>`
      ];

      header.forEach(text => {
        const line = document.createElement("div");
        line.className = "line";
        line.textContent = text;
        terminal.appendChild(line);
      });

      setInterval(() => {
        updateState();
        render(terminal);
      }, TICK_MS);
    })();
  </script>
</body>
</html>
